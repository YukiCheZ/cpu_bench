# metadata.yaml for CockroachDB benchmark
name: cockroachdb_benchmark
type: macrobenchmark
language: Go
domain:
  - database
  - transactions
  - performance
  - distributed_systems

setup: 
  command: ./setup.sh

workloads:
  - name: kv
    description: >
      Benchmark for CockroachDB using the built-in "workload kv" runner.
      This workload launches a single-node CockroachDB cluster locally,
      initializes the key-value dataset, and runs transactional read/write
      operations with configurable read percentages and concurrency.
    command: go run src/kv.go
    parameters:
      cockroachdb-bin:
        description: Path to CockroachDB binary (or set COCKROACH_BIN env var)
        default: ./bin/cockroach
      host:
        description: Hostname of the CockroachDB server
        default: localhost
      tmp:
        description: Temporary directory for cluster data
        default: ""
      max-ops:
        description: Maximum number of operations to run PER CORE
        default: 1200000
      kv:
        description: KV read percentage (must be 0, 50, or 95)
        default: 50
      threads:
        description: Number of threads (sets GOMAXPROCS for CockroachDB process)
        default: 1

  - name: tpcc
    description: >
      Benchmark for CockroachDB using the built-in "workload tpcc" runner.
      This workload launches a single-node CockroachDB cluster locally,
      initializes the TPCC dataset, and runs transactional read/write
      operations with configurable parameters.
    command: go run src/tpcc.go
    parameters:
      cockroachdb-bin:
        description: Path to CockroachDB binary (or set COCKROACH_BIN env var)
        default: ./bin/cockroach
      host:
        description: Hostname of the CockroachDB server
        default: localhost
      tmp:
        description: Temporary directory for cluster data
        default: ""
      max-ops:
        description: Maximum number of operations to run per thread
        default: 30000
      warehouses:
        description: Number of warehouses for TPCC data per thread (larger -> more data)
        default: 1
      concurrency:
        description: Number of concurrent workers (concurrency param passed to tpcc)
        default: 200
      threads:
        description: Number of threads (sets GOMAXPROCS for CockroachDB process)
        default: 1

characteristics:
  IO_effects: high
  single_machine: true
  network_effects: low
  cpu_bound: true
  memory_intensive: high

tags:
  - cpu
  - database
  - transactions
  - cockroachdb
  - sql
  - kv
  - go

dependencies:
  go: "1.24.5"
  
