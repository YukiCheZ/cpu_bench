# metadata.yaml for esbuild benchmark
name: esbuild_benchmark
type: macrobenchmark
language: Go
domain:
  - compiler
  - javascript
  - bundler
  - web_development
  - rendering

setup:
  command: ./setup.sh

workloads:
  - name: ThreeJS
    summary: JavaScript library bundling and minification
    action: bundle and minify a large JavaScript codebase
    description: >
      Execute the esbuild bundler on a synthetic JavaScript project modeled after the Three.js library structure.
      Perform full bundling, minification, and source map generation to produce a single optimized output file.
      Measure the compilation speed and resource usage to evaluate the CPU's performance on web development build toolchains.
    data: 
      command: python3 generate_data.py --lang js
      parameters:
        size:
          full_name: number of files
          description: Number of files to generate
          default: 500
        complexity:
          full_name: file complexity
          description: Complexity of each file
          default: 2000
        out:
          full_name: output directory
          description: Output directory for generated files
          default: ./data/demo_js
        repeat-imports:
          full_name: repeat imports
          description: Number of times to repeat imports in each file
          default: 10
        heavy-factor:
          full_name: heavy factor
          description: Additional heavy factor per file
          default: 50
    command: go run main.go --bench ThreeJS 
    parameters:
      bin:
        full_name: esbuild binary path
        description: Path to esbuild binary
        default: ./bin/esbuild
      src:
        full_name: source directory
        description: Path to JavaScript/TypeScript source to bundle
        default: ./data/demo_js
      threads:
        full_name: threads
        description: Number of threads to use 
        default: 1
      iters:
        full_name: iterations
        description: Number of iterations to run
        default: 30
  
  - name: RomeTS
    summary: TypeScript project compilation and bundling
    action: compile and bundle a TypeScript application
    description: >
      Invoke the esbuild compiler to process a synthetic TypeScript project simulating the Rome toolchain.
      Transpile TypeScript code to JavaScript, bundle modules, minify the output, and generate source maps for a Node.js target.
      Assess the system's compilation throughput and latency during intensive string processing and syntax tree manipulation tasks.
    data: 
      command: python3 generate_data.py --lang ts
      parameters:
        size:
          full_name: number of files
          description: Number of files to generate
          default: 500
        complexity:
          full_name: file complexity
          description: Complexity of each file
          default: 2000
        out:
          full_name: output directory
          description: Output directory for generated files
          default: ./data/demo_js
        repeat-imports:
          full_name: repeat imports
          description: Number of times to repeat imports in each file
          default: 10
        heavy-factor:
          full_name: heavy factor
          description: Additional heavy factor per file
          default: 50
    command: go run main.go --bench RomeTS
    parameters:
      bin:
        full_name: esbuild binary path
        description: Path to esbuild binary
        default: ./bin/esbuild
      src:
        full_name: source directory
        description: Path to JavaScript/TypeScript source to bundle
        default: ./data/demo_js
      threads:
        full_name: threads
        description: Number of threads to use
        default: 1
      iters:  
        full_name: iterations
        description: Number of iterations to run
        default: 30
    
characteristics:
  IO_effects: medium
  single_machine: true
  network_effects: none
  cpu_bound: true
  memory_intensive: medium
  storage_intensive: low

tags:
  - cpu
  - compiler
  - javascript
  - bundler
  - esbuild
  - minify
  - sourcemap

dependencies:
  go: "1.24.5"
