# metadata.yaml for OpenCV CPU Benchmark
name: opencv_benchmark
type: microbenchmark
language: C++
domain:
  - computer_vision
  - image_processing

setup:
  command: ./setup.sh
  parameters:
    compiler:
      full_name: compiler
      description: Compiler to use
      default: gcc
    opt:
      full_name: optimization level
      description: Optimization level
      default: -O3

workloads:
  - name: fft_batch
    summary: Fast Fourier Transform batch processing on images
    action: execute discrete Fourier transforms on image data
    description: >
      Convert input images to floating-point grayscale format and pad them to the optimal size for Discrete Fourier Transform (DFT).
      Perform multiple forward DFT passes on the image data to measure the CPU's capability in handling frequency domain transformations and complex number arithmetic.
    command: ./bin/opencv_benchmark --workload fft_batch
    parameters:
      size:
        full_name: image size
        description: Width/Height of square images
        unit: pixels
        default: 1024
      images:
        full_name: number of images
        description: Number of images to process per iteration
        default: 50
      iters:
        full_name: iterations
        description: Number of timing iterations
        default: 50
      threads:
        full_name: threads
        description: Number of parallel threads
        default: 1
      warmup:
        full_name: warmup iterations
        description: Number of warmup iterations to run before timing
        default: 2

  - name: conv_heavy
    summary: intensive image convolution with Gaussian kernels
    action: apply repeated 2D convolution filters
    description: >
      Apply a stack of heavy 2D convolutions to the input image using a large Gaussian kernel.
      Execute multiple filtering iterations followed by normalization to simulate deep convolutional layers found in computer vision pipelines, stressing the CPU's floating-point multiply-accumulate performance.
    command: ./bin/opencv_benchmark --workload conv_heavy
    parameters:
      size:
        full_name: image size
        description: Width/Height of square images
        unit: pixels
        default: 1024
      images:
        full_name: number of images
        description: Number of images to process per iteration
        default: 50
      iters:
        full_name: iterations
        description: Number of timing iterations
        default: 25
      threads:
        full_name: threads
        description: Number of parallel threads
        default: 1
      warmup:
        full_name: warmup iterations
        description: Number of warmup iterations to run before timing
        default: 2
  
  - name: mandelbrot
    summary: floating-point intensive Mandelbrot fractal generation
    action: compute Mandelbrot set pixel values
    description: >
      Generate a Mandelbrot fractal image by iterating complex number equations for each pixel.
      Perform intensive floating-point arithmetic to determine pixel intensity based on the escape time algorithm, evaluating the CPU's raw scalar floating-point computational throughput.
    command: ./bin/opencv_benchmark --workload mandelbrot
    parameters:
      size:
        full_name: image size
        description: Width/Height of square images
        unit: pixels
        default: 1024
      images:
        full_name: number of images
        description: Number of images to process per iteration
        default: 50
      iters:
        full_name: iterations
        description: Number of timing iterations
        default: 40
      threads:
        full_name: threads
        description: Number of parallel threads
        default: 1
      warmup:
        full_name: warmup iterations
        description: Number of warmup iterations to run before timing
        default: 2

  - name: jacobi
    summary: iterative Jacobi method for solving PDEs
    action: solve Poisson equation using Jacobi iteration
    description: >
      Simulate a 2D Poisson Partial Differential Equation (PDE) solver using the Jacobi iterative method.
      Update a grid of values based on neighboring cells in repeated passes, measuring memory bandwidth and cache efficiency in stencil-based scientific computations.
    command: ./bin/opencv_benchmark --workload jacobi
    parameters:
      size:
        full_name: image size
        description: Width/Height of square images
        unit: pixels
        default: 2048
      images:
        full_name: number of images
        description: Number of images to process per iteration
        default: 50
      iters:
        full_name: iterations
        description: Number of timing iterations
        default: 400
      threads:
        full_name: threads
        description: Number of parallel threads
        default: 1
      warmup:
        full_name: warmup iterations
        description: Number of warmup iterations to run before timing
        default: 2

  - name: canny
    summary: Canny edge detection algorithm execution
    action: detect edges in images using Canny method
    description: >
      Apply the Canny edge detection algorithm to input images to identify structural boundaries.
      Convert images to grayscale and execute multi-stage edge detection, including gradient calculation and hysteresis thresholding, to evaluate performance on standard image processing tasks.
    command: ./bin/opencv_benchmark --workload canny
    parameters:
      size:
        full_name: image size
        description: Width/Height of square images
        unit: pixels
        default: 2048
      images:
        full_name: number of images
        description: Number of images to process per iteration
        default: 50
      iters:
        full_name: iterations
        description: Number of timing iterations
        default: 150
      threads:
        full_name: threads
        description: Number of parallel threads
        default: 1
      warmup:
        full_name: warmup iterations
        description: Number of warmup iterations to run before timing
        default: 2

  - name: optical_flow
    summary: dense optical flow estimation using Farneback
    action: calculate dense optical flow between frames
    description: >
      Compute dense optical flow between consecutive image frames using the Farneback algorithm.
      Analyze pixel motion vectors to estimate displacement, testing the CPU's ability to handle complex computer vision algorithms required for video analysis and motion tracking.
    command: ./bin/opencv_benchmark --workload optical_flow
    parameters:
      size:
        full_name: image size
        description: Width/Height of square images
        unit: pixels
        default: 1024
      images:
        full_name: number of images
        description: Number of images to process per iteration
        default: 50
      iters:
        full_name: iterations
        description: Number of timing iterations
        default: 50
      threads:
        full_name: threads
        description: Number of parallel threads
        default: 1
      warmup:
        full_name: warmup iterations
        description: Number of warmup iterations to run before timing
        default: 2

  - name: motion_blur
    summary: linear motion blur effect application
    action: apply motion blur filter to images
    description: >
      Simulate a linear motion blur effect by convolving the image with a diagonal kernel.
      Perform 2D filtering operations to mimic camera shake or object movement, assessing the efficiency of the CPU in processing spatial domain image effects.
    command: ./bin/opencv_benchmark --workload motion_blur
    parameters:
      size:
        full_name: image size
        description: Width/Height of square images
        unit: pixels
        default: 2048
      images:
        full_name: number of images
        description: Number of images to process per iteration
        default: 50
      iters:
        full_name: iterations
        description: Number of timing iterations
        default: 40
      threads:
        full_name: threads
        description: Number of parallel threads
        default: 1
      warmup:
        full_name: warmup iterations
        description: Number of warmup iterations to run before timing
        default: 2

  - name: background_sub
    summary: background subtraction using MOG2 algorithm
    action: extract foreground masks from video frames
    description: >
      Apply the Gaussian Mixture-based Background/Foreground Segmentation (MOG2) algorithm to input images.
      Update the background model and generate a foreground mask for each frame, evaluating performance in surveillance-style video processing workloads.
    command: ./bin/opencv_benchmark --workload background_sub
    parameters:
      size:
        full_name: image size
        description: Width/Height of square images
        unit: pixels
        default: 1080
      images:
        full_name: number of images
        description: Number of images to process per iteration
        default: 100
      iters:
        full_name: iterations
        description: Number of timing iterations
        default: 50
      threads:
        full_name: threads
        description: Number of parallel threads
        default: 1
      warmup:
        full_name: warmup iterations
        description: Number of warmup iterations to run before timing
        default: 2
  
  - name: color_tracking
    summary: object tracking via color thresholding and morphology
    action: isolate objects using HSV color space
    description: >
      Convert images from BGR to HSV color space and apply thresholding to isolate specific color ranges.
      Perform morphological operations like erosion and dilation to clean up the resulting binary mask, simulating a basic object tracking pipeline.
    command: ./bin/opencv_benchmark --workload color_tracking
    parameters:
      size:
        full_name: image size
        description: Width/Height of square images
        unit: pixels
        default: 2160
      images:
        full_name: number of images
        description: Number of images to process per iteration
        default: 100
      iters:
        full_name: iterations
        description: Number of timing iterations
        default: 200
      threads:
        full_name: threads
        description: Number of parallel threads
        default: 1
      warmup:
        full_name: warmup iterations
        description: Number of warmup iterations to run before timing
        default: 2

  - name: feature_match
    summary: ORB feature detection and descriptor matching
    action: detect and match image features
    description: >
      Detect keypoints and compute descriptors using the ORB (Oriented FAST and Rotated BRIEF) algorithm.
      Match features between consecutive frames using a Brute-Force matcher with Hamming distance, measuring performance in feature-based image registration and SLAM tasks.
    command: ./bin/opencv_benchmark --workload feature_match
    parameters:
      size:
        full_name: image size
        description: Width/Height of square images
        unit: pixels
        default: 1024
      images:
        full_name: number of images
        description: Number of images to process per iteration
        default: 100
      iters:
        full_name: iterations
        description: Number of timing iterations
        default: 120
      threads:
        full_name: threads
        description: Number of parallel threads
        default: 1
      warmup:
        full_name: warmup iterations
        description: Number of warmup iterations to run before timing
        default: 2
  

characteristics:
  IO_effects: minimal
  single_machine: true
  network_effects: false
  memory_bound: true
  cpu_bound: true

tags:
  - filtering
  - convolution
  - linear_algebra
  - histogram

dependencies:
  opencv: ">=4.0"
  c++: ">=17"
